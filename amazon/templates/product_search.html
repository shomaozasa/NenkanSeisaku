{% extends 'base.html' %}

{% block title %}検索結果{% endblock %}

{% block contents %}
<style>
  ul {
    display: flex;
    flex-wrap: wrap;
  }

  li {
    margin: 10px;
  }
</style>
<h2>商品検索結果</h2>
{% if query %}
<p>検索文字: {{ query }}</p>
{% endif %}

{% if message %}
    <p>{{ message }}</p>
{% else %}

<label for="sort-select">ソート：</label>
<select id="sort-select">
  <option value="price-asc">価格順 (昇順)</option>
  <option value="price-desc">価格順 (降順)</option>
  <option value="name-asc">名前順 (昇順)</option>
  <option value="name-desc">名前順 (降順)</option>
  <option value="rating-asc">評価順 (昇順)</option>
  <option value="rating-desc">評価順 (降順)</option>
</select>
<br>
<ul id="product-list">
  {% for product in products %}
  <li data-price="{{ product.price }}" data-name="{{ product.product_name }}"
    data-rating="{{ product.average_rating }}">
    <strong><a href="{% url 'amazon:product' product_id=product.product_id %}">{{ product.product_name }}</a></strong><br>
    ブランド: {{ product.brand }}<br>
    カテゴリ: {{ product.category }}<br>
    価格: ¥{{ product.price }}<br>
    評価: ☆{{ product.average_rating|default:"0.0" }}<br>
    {% if product.product_image %}
    商品画像↓<br>
    <a href="{% url 'amazon:product' product_id=product.product_id %}"><img src="{{ product.product_image.url }}"
        alt="{{ product.product_name }}" width="100" height="100"></a>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endif %}

<script>
  document.getElementById('sort-select').addEventListener('change', function () {
    let sortCriteria = this.value.split('-');
    let sortField = sortCriteria[0];
    let sortOrder = sortCriteria[1];
    let productList = document.getElementById('product-list');
    let products = Array.from(productList.children);

    products.sort(function (a, b) {
        let aValue = a.getAttribute('data-' + sortField);
        let bValue = b.getAttribute('data-' + sortField);

        if (sortField === 'name') {
            if (sortOrder === 'asc') {
                return aValue.localeCompare(bValue, 'ja');
            } else {
                return bValue.localeCompare(aValue, 'ja');
            }
        } else {
            if (sortOrder === 'asc') {
                return aValue - bValue;
            } else {
                return bValue - aValue;
            }
        }
    });

    productList.innerHTML = '';
    products.forEach(function (product) {
        productList.appendChild(product);
    });
});

</script>

{% endblock %}